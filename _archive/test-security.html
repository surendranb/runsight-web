<!DOCTYPE html>
<html>
<head>
    <title>Security Test - Can I Access Other Users' Data?</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>üîç Security Test</h1>
    <p>This page tests if your database is vulnerable to unauthorized access.</p>
    
    <button onclick="testSecurity()">Test Database Security</button>
    <div id="results"></div>

    <script>
        async function testSecurity() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>Testing...</p>';
            
            try {
                // Extract your actual Supabase credentials
                // (In real attack, these would be extracted from your website)
                const supabaseUrl = prompt('Enter your Supabase URL:');
                const supabaseKey = prompt('Enter your Supabase anon key:');
                
                if (!supabaseUrl || !supabaseKey) {
                    results.innerHTML = '<p>‚ùå Need credentials to test</p>';
                    return;
                }
                
                // Create client (simulating attacker)
                const { createClient } = supabase;
                const client = createClient(supabaseUrl, supabaseKey);
                
                // Try to access runs table without authentication
                const { data, error } = await client
                    .from('runs')
                    .select('*');
                
                if (error) {
                    results.innerHTML = `
                        <div style="color: green; padding: 20px; border: 2px solid green;">
                            <h2>‚úÖ SECURE!</h2>
                            <p>Your database rejected unauthorized access.</p>
                            <p>Error: ${error.message}</p>
                            <p>This means RLS is working properly.</p>
                        </div>
                    `;
                } else if (data && data.length > 0) {
                    results.innerHTML = `
                        <div style="color: red; padding: 20px; border: 2px solid red;">
                            <h2>üö® VULNERABLE!</h2>
                            <p>Found ${data.length} runs without authentication!</p>
                            <p>This means anyone can access all user data.</p>
                            <p><strong>URGENT: Enable RLS immediately!</strong></p>
                            <details>
                                <summary>Exposed data preview:</summary>
                                <pre>${JSON.stringify(data.slice(0, 2), null, 2)}</pre>
                            </details>
                        </div>
                    `;
                } else {
                    results.innerHTML = `
                        <div style="color: orange; padding: 20px; border: 2px solid orange;">
                            <h2>‚ö†Ô∏è UNCLEAR</h2>
                            <p>No data returned, but no error either.</p>
                            <p>This could mean the table is empty or RLS is working.</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                results.innerHTML = `
                    <div style="color: red; padding: 20px; border: 2px solid red;">
                        <h2>‚ùå TEST FAILED</h2>
                        <p>Error running test: ${error.message}</p>
                    </div>
                `;
            }
        }
    </script>
    
    <div style="margin-top: 40px; padding: 20px; background: #f5f5f5;">
        <h3>How This Test Works:</h3>
        <ol>
            <li>Creates a Supabase client with your public credentials</li>
            <li>Tries to query the 'runs' table without authentication</li>
            <li>If it gets data ‚Üí You're vulnerable</li>
            <li>If it gets an error ‚Üí You're protected by RLS</li>
        </ol>
        
        <h3>What Attackers Would Do:</h3>
        <ol>
            <li>Visit your website</li>
            <li>Open browser dev tools</li>
            <li>Extract your Supabase URL and key from network requests</li>
            <li>Run this exact same test</li>
            <li>If vulnerable, download all user data</li>
        </ol>
    </div>
</body>
</html>